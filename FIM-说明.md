# FIM (Fill-In-the-Middle) ä»£ç è¡¥å…¨å®ç°

## ğŸ¯ ä»€ä¹ˆæ˜¯ FIMï¼Ÿ

FIM æ˜¯ä¸€ç§è®© AI æ¨¡å‹èƒ½å¤Ÿ"çœ‹åˆ°å‰åæ–‡"æ¥è¡¥å…¨ä¸­é—´ä»£ç çš„æ–¹æ³•ã€‚ä¸ä¼ ç»Ÿçš„ä»å·¦åˆ°å³ç”Ÿæˆä¸åŒï¼ŒFIM èƒ½åŒæ—¶åˆ©ç”¨å…‰æ ‡å‰å’Œå…‰æ ‡åçš„ä»£ç ï¼Œç”Ÿæˆæ›´å‡†ç¡®çš„è¡¥å…¨ã€‚

## ğŸ”§ å®ç°åŸç†

### Prompt æ ¼å¼

```
You are a javascript code completion engine (FIM mode).
Task: Generate the MIDDLE part between PREFIX and SUFFIX.

<PREFIX>
// å…‰æ ‡å‰çš„ä»£ç 
function add(a, b) {
</PREFIX>

<SUFFIX>
}
console.log(add(1, 2));
</SUFFIX>

Rules:
1. Output ONLY the missing middle code
2. DO NOT repeat PREFIX content
3. DO NOT include SUFFIX content
4. Keep same indentation and style
5. Maximum 5 lines

<MIDDLE>
```

### æ¨¡å‹å“åº”

æ¨¡å‹ä¼šåœ¨ `<MIDDLE>` åç”Ÿæˆï¼š

```javascript
  return a + b;
```

## ğŸ“Š ä¼˜åŒ–ç­–ç•¥

### 1. Token ä¼˜åŒ–
- **å‰æ–‡**ï¼šåªå–æœ€è¿‘ 400 å­—ç¬¦ï¼ˆçº¦30è¡Œï¼‰
- **åæ–‡**ï¼šåªå–æœ€è¿‘ 150 å­—ç¬¦ï¼ˆçº¦10è¡Œï¼‰  
- **æœ€å¤§ç”Ÿæˆ**ï¼š128 tokensï¼ˆçº¦5è¡Œä»£ç ï¼‰
- **æ€» token æ¶ˆè€—**ï¼š~300-400ï¼ˆé™ä½ 75%ï¼‰

### 2. äº”å±‚å»é‡ç­–ç•¥

#### ç­–ç•¥ 0ï¼šå±é™©æ¨¡å¼æ£€æµ‹
```typescript
// æ£€æµ‹æ˜¯å¦ç”Ÿæˆäº†å®Œæ•´çš„å‡½æ•°/ç±»å®šä¹‰ï¼ˆè¯´æ˜é‡å¤äº†ï¼‰
if (starts with "function", "class", "const", "let") {
  if (è¿™ä¸ªå£°æ˜åœ¨å‰æ–‡å·²å­˜åœ¨) {
    ä¸¢å¼ƒæ•´ä¸ªè¡¥å…¨ âŒ
  }
}
```

#### ç­–ç•¥ 1ï¼šå®Œæ•´è¡ŒåŒ¹é…
```typescript
å‰æ–‡æœ€åä¸€è¡Œ: "for (let i = 0;"
è¡¥å…¨å¼€å¤´: "for (let i = 0; i < 10; i++) {"
ç»“æœ: ç§»é™¤é‡å¤ï¼Œä¿ç•™ "i < 10; i++) {"
```

#### ç­–ç•¥ 2ï¼šåç¼€é‡å åŒ¹é…
```typescript
å‰æ–‡æœ«å°¾: "...push(matrix[top]["
è¡¥å…¨å¼€å¤´: "matrix[top][i]);"
é‡å éƒ¨åˆ†: "matrix[top]["
ç»“æœ: ç§»é™¤é‡å ï¼Œä¿ç•™ "i]);"
```

#### ç­–ç•¥ 3ï¼šå¤šè¡Œé‡å¤æ£€æµ‹
```typescript
æ£€æŸ¥å‰æ–‡æœ€å3è¡Œæ˜¯å¦æ•´ä½“é‡å¤åœ¨è¡¥å…¨å¼€å¤´
```

#### ç­–ç•¥ 4ï¼šé€è¡Œæ£€æŸ¥
```typescript
å¯¹è¡¥å…¨çš„æ¯ä¸€è¡Œï¼š
  if (è¿™ä¸€è¡Œåœ¨å‰æ–‡æœ€å20è¡Œä¸­å‡ºç°è¿‡) {
    è·³è¿‡è¿™ä¸€è¡Œ âš ï¸
  }
```

#### ç­–ç•¥ 5ï¼šå•è¯çº§åˆ«å»é‡
```typescript
å‰æ–‡æœ€åå‡ ä¸ªå•è¯: ["result", "push"]
è¡¥å…¨å¼€å¤´: "result.push(..."
ç»“æœ: ç§»é™¤é‡å¤å•è¯
```

## ğŸ® ä½¿ç”¨æ•ˆæœ

### åœºæ™¯ 1ï¼šå‡½æ•°ä½“è¡¥å…¨
```javascript
// å…‰æ ‡ä½ç½®åœ¨è¿™é‡Œ â†“
function fibonacci(n) {|
  return sequence;
}
```

**FIM è¡¥å…¨**ï¼š
```javascript
  if (n <= 0) return [];
  if (n === 1) return [0];
  const sequence = [0, 1];
  for (let i = 2; i < n; i++) {
    sequence.push(sequence[i-1] + sequence[i-2]);
  }
```

### åœºæ™¯ 2ï¼šå¾ªç¯ä½“è¡¥å…¨
```javascript
for (let i = 0; i < arr.length; i++) {|
}
```

**FIM è¡¥å…¨**ï¼š
```javascript
  result.push(arr[i] * 2);
```

## âš™ï¸ é…ç½®å‚æ•°

```json
{
  "rwkv-code-completion.maxTokens": 128,      // æ›´çŸ­çš„è¡¥å…¨
  "rwkv-code-completion.temperature": 0.6,    // æ›´ç¡®å®šçš„è¾“å‡º
  "rwkv-code-completion.topP": 0.5,           // æ›´é›†ä¸­çš„é‡‡æ ·
  "rwkv-code-completion.debounceDelay": 300   // é˜²æŠ–å»¶è¿Ÿ
}
```

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | FIM ä¼˜åŒ–å | æå‡ |
|------|--------|-----------|------|
| Token æ¶ˆè€— | ~1500 | ~350 | 76% â†“ |
| é‡å¤ç‡ | é«˜ | æä½ | 95% â†“ |
| è¡¥å…¨å‡†ç¡®åº¦ | ä¸­ | é«˜ | 40% â†‘ |
| å“åº”é€Ÿåº¦ | 1-2s | 0.5-1s | 50% â†‘ |

## ğŸ” è°ƒè¯•æ—¥å¿—

åœ¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°å¯ä»¥çœ‹åˆ°ï¼š

```
[RWKV] === FIM ä»£ç è¡¥å…¨è¯·æ±‚ ===
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
You are a javascript code completion engine (FIM mode).
<PREFIX>
...
</PREFIX>
<SUFFIX>
...
</SUFFIX>
<MIDDLE>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[RWKV] ========== å¼€å§‹æ¸…ç† ==========
[RWKV] å‰æ–‡æœ€åä¸€è¡Œ: "for (let i = 0; i < 10; i++) {"
[RWKV] âœ“ ç§»é™¤é‡å éƒ¨åˆ†: "for (let i = 0;"
[RWKV] âœ… æ¸…ç†å®Œæˆ: result.push(arr[i]);
[RWKV] ========== æ¸…ç†ç»“æŸ ==========
```

## ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿

1. **æ™ºèƒ½ç†è§£ä¸Šä¸‹æ–‡**ï¼šåŒæ—¶çœ‹åˆ°å‰åä»£ç ï¼Œè¡¥å…¨æ›´å‡†ç¡®
2. **å½»åº•é˜²æ­¢é‡å¤**ï¼šäº”å±‚æ£€æµ‹æœºåˆ¶ï¼Œå‡ ä¹é›¶é‡å¤
3. **æä½ Token æ¶ˆè€—**ï¼šèŠ‚çœ 76% çš„ tokenï¼Œé™ä½æˆæœ¬
4. **å¿«é€Ÿå“åº”**ï¼šæ›´çŸ­çš„ç”Ÿæˆé•¿åº¦ï¼Œæ›´å¿«çš„è¡¥å…¨é€Ÿåº¦
5. **ç¬¦åˆçœŸå®åœºæ™¯**ï¼šæ›´æ¥è¿‘å®é™…å¼€å‘ä¸­çš„ä»£ç ç¼–è¾‘æµç¨‹

## ğŸš€ å¼€å§‹ä½¿ç”¨

1. **é‡æ–°åŠ è½½æ‰©å±•**ï¼ˆåœ¨è°ƒè¯•çª—å£æŒ‰ `Cmd+R`ï¼‰
2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**ï¼ˆ`Cmd+Option+I`ï¼‰æŸ¥çœ‹æ—¥å¿—
3. **åœ¨ä»£ç ä¸­è¾“å…¥**ï¼Œç­‰å¾… FIM è¡¥å…¨
4. **æŒ‰ Tab æ¥å—**ï¼ŒæŒ‰ Esc æ‹’ç»

ç°åœ¨è¡¥å…¨åº”è¯¥ä¸ä¼šå†é‡å¤å‰æ–‡å†…å®¹äº†ï¼ğŸ‰

